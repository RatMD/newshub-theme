import{createRef as t,useRef as n,useMemo as i,useEffect as r}from"react";import{PanResponder as e}from"react-native";var a=function(){return a=Object.assign||function(t){for(var n,i=1,r=arguments.length;i<r;i++)for(var e in n=arguments[i])Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e]);return t},a.apply(this,arguments)};function o(t,n,i){if(i||2===arguments.length)for(var r,e=0,a=n.length;e<a;e++)!r&&e in n||(r||(r=Array.prototype.slice.call(n,0,e)),r[e]=n[e]);return t.concat(r||Array.prototype.slice.call(n))}function u(){return Date.now()}function s(t){return function(n){n.nativeEvent&&(n=n.nativeEvent);var i=n.changedTouches||[],r=n.targetTouches||[],e=n.detail&&n.detail.x?n.detail:null;return t({id:e?e.identifier?e.identifier:"i":r[0]?r[0]?r[0].identifier:"e":"d",idChanged:e?e.identifier?e.identifier:"i":i[0]?i[0]?i[0].identifier:"e":"d",raw:n,x:e&&e.x?e.x:r[0]?r[0].screenX:e?e.x:n.pageX,y:e&&e.y?e.y:r[0]?r[0].screenY:e?e.y:n.pageY})}}function c(t,n,i){return Math.min(Math.max(t,n),i)}function d(t){return(t>0?1:0)-(t<0?1:0)||+t}function l(t,n,i,r){var e=t&&t[n];return null==e?i:r&&"function"==typeof e?e():e}function f(t){return Math.round(1e6*t)/1e6}function p(t,n){if(t===n)return!0;var i=typeof t;if(i!==typeof n)return!1;if("object"!==i||null===t||null===n)return"function"===i&&t.toString()===n.toString();if(t.length!==n.length||Object.getOwnPropertyNames(t).length!==Object.getOwnPropertyNames(n).length)return!1;for(var r in t)if(!p(t[r],n[r]))return!1;return!0}function v(t,n){return p(t.current,n)||(t.current=n),t.current}function m(t){var n,i,r,e,a,o;function u(n){o||(o=n),s(!0);var a=n-o;a>r&&(a=r);var l=e[i];if(l[3]<a)return i++,u(n);var f=l[2],p=l[4],v=l[0],m=l[1]*(0,l[5])(0===p?1:(a-f)/p);if(m&&t.track.to(v+m),a<r)return d();o=null,s(!1),c(null),t.emit("animationEnded")}function s(t){n.active=t}function c(t){n.targetIdx=t}function d(){var t;t=u,a=window.requestAnimationFrame(t)}function l(){var n;n=a,window.cancelAnimationFrame(n),s(!1),c(null),o&&t.emit("animationStopped"),o=null}return n={active:!1,start:function(n){if(l(),t.track.details){var a=0,o=t.track.details.position;i=0,r=0,e=n.map((function(t){var n,i=o,e=null!==(n=t.earlyExit)&&void 0!==n?n:t.duration,u=t.easing,s=t.distance*u(e/t.duration)||0;o+=s;var c=r;return r+=e,a+=s,[i,t.distance,c,r,t.duration,u]})),c(t.track.distToIdx(a)),d(),t.emit("animationStarted")}},stop:l,targetIdx:null}}function h(t){var n,i,r,e,a,s,p,v,m,h,g,b,x,y,k=1/0,M=[],T=null,w=0;function P(t){j(w+t)}function C(t){var n=z(w+t).abs;return O(n)?n:null}function z(t){var n=Math.floor(Math.abs(f(t/i))),r=f((t%i+i)%i);r===i&&(r=0);var e=d(t),a=p.indexOf(o([],p,!0).reduce((function(t,n){return Math.abs(n-r)<Math.abs(t-r)?n:t}))),u=a;return e<0&&n++,a===s&&(u=0,n+=e>0?1:-1),{abs:u+n*s*e,origin:a,rel:u}}function E(t,n,i){var r;if(n||!D())return I(t,i);if(!O(t))return null;var e=z(null!=i?i:w),a=e.abs,o=t-e.rel,u=a+o;r=I(u);var c=I(u-s*d(o));return(null!==c&&Math.abs(c)<Math.abs(r)||null===r)&&(r=c),f(r)}function I(t,n){if(null==n&&(n=f(w)),!O(t)||null===t)return null;t=Math.round(t);var r=z(n),e=r.abs,a=r.rel,o=r.origin,u=R(t),c=(n%i+i)%i,d=p[o],l=Math.floor((t-(e-a))/s)*i;return f(d-c-d+p[u]+l+(o===s?i:0))}function O(t){return S(t)===t}function S(t){return c(t,m,h)}function D(){return e.loop}function R(t){return(t%s+s)%s}function j(n){var i;i=n-w,M.push({distance:i,timestamp:u()}),M.length>6&&(M=M.slice(-6)),w=f(n);var r=A().abs;if(r!==T){var e=null!==T;T=r,e&&t.emit("slideChanged")}}function A(o){var u=o?null:function(){if(s){var t=D(),n=t?(w%i+i)%i:w,o=(t?w%i:w)-a[0][2],u=0-(o<0&&t?i-Math.abs(o):o),c=0,l=z(w),f=l.abs,p=l.rel,v=a[p][2],k=a.map((function(n,r){var a=u+c;(a<0-n[0]||a>1)&&(a+=(Math.abs(a)>i-1&&t?i:0)*d(-a));var o=r-p,l=d(o),m=o+f;t&&(-1===l&&a>v&&(m+=s),1===l&&a<v&&(m-=s),null!==g&&m<g&&(a+=i),null!==b&&m>b&&(a-=i));var h=a+n[0]+n[1],x=Math.max(a>=0&&h<=1?1:h<0||a>1?0:a<0?Math.min(1,(n[0]+a)/n[0]):(1-a)/n[0],0);return c+=n[0]+n[1],{abs:m,distance:e.rtl?-1*a+1-n[0]:a,portion:x,size:n[0]}}));return f=S(f),p=R(f),{abs:S(f),length:r,max:y,maxIdx:h,min:x,minIdx:m,position:w,progress:t?n/i:w/r,rel:p,slides:k,slidesLength:i}}}();return n.details=u,t.emit("detailsChanged"),u}return n={absToRel:R,add:P,details:null,distToIdx:C,idxToDist:E,init:function(n){if(function(){if(e=t.options,a=(e.trackConfig||[]).map((function(t){return[l(t,"size",1),l(t,"spacing",0),l(t,"origin",0)]})),s=a.length){i=f(a.reduce((function(t,n){return t+n[0]+n[1]}),0));var n,o=s-1;r=f(i+a[0][2]-a[o][0]-a[o][2]-a[o][1]),p=a.reduce((function(t,i){if(!t)return[0];var r=a[t.length-1],e=t[t.length-1]+(r[0]+r[2])+r[1];return e-=i[2],t[t.length-1]>e&&(e=t[t.length-1]),e=f(e),t.push(e),(!n||n<e)&&(v=t.length-1),n=e,t}),null),0===r&&(v=0),p.push(f(i))}}(),!s)return A(!0);var o;!function(){var n=t.options.range,i=t.options.loop;g=m=i?l(i,"min",-1/0):0,b=h=i?l(i,"max",k):v;var r=l(n,"min",null),e=l(n,"max",null);r&&(m=r),e&&(h=e),x=m===-1/0?m:t.track.idxToDist(m||0,!0,0),y=h===k?h:E(h,!0,0),null===e&&(b=h),l(n,"align",!1)&&h!==k&&0===a[R(h)][2]&&(y-=1-a[R(h)][0],h=C(y-w)),x=f(x),y=f(y)}(),o=n,Number(o)===o?P(I(S(n))):A()},to:j,velocity:function(){var t=u(),n=M.reduce((function(n,i){var r=i.distance,e=i.timestamp;return t-e>200||(d(r)!==d(n.distance)&&n.distance&&(n={distance:0,lastTimestamp:0,time:0}),n.time&&(n.distance+=r),n.lastTimestamp&&(n.time+=e-n.lastTimestamp),n.lastTimestamp=e),n}),{distance:0,lastTimestamp:0,time:0});return n.distance/n.time||0}}}function g(t){var n,i,r,e,a,o,u;function s(t){return 2*t}function l(t){return c(t,o,u)}function f(t){return 1-Math.pow(1-t,3)}function p(){h();var n="free-snap"===t.options.mode,i=t.track,o=i.velocity();r=d(o);var u=t.track.details,c=[];if(o||!n){var p=v(o),m=p.dist,g=p.dur;if(g=s(g),m*=r,n){var b=i.idxToDist(i.distToIdx(m),!0);b&&(m=b)}c.push({distance:m,duration:g,easing:f});var x=u.position,y=x+m;if(y<e||y>a){var k=y<e?e-x:a-x,M=0,T=o;if(d(k)===r){var w=Math.min(Math.abs(k)/Math.abs(m),1),P=function(t){return 1-Math.pow(1-t,1/3)}(w)*g;c[0].earlyExit=P,T=o*(1-w)}else c[0].earlyExit=0,M+=k;var C=v(T,100),z=C.dist*r;t.options.rubberband&&(c.push({distance:z,duration:s(C.dur),easing:f}),c.push({distance:-z+M,duration:500,easing:f}))}t.animator.start(c)}else t.moveToIdx(l(u.abs),!0,{duration:500,easing:function(t){return 1+--t*t*t*t*t}})}function v(t,n){void 0===n&&(n=1e3);var i=147e-9+(t=Math.abs(t))/n;return{dist:Math.pow(t,2)/i,dur:t/i}}function m(){var n=t.track.details;n&&(e=n.min,a=n.max,o=n.minIdx,u=n.maxIdx)}function h(){t.animator.stop()}t.on("updated",m),t.on("optionsChanged",m),t.on("created",m),t.on("dragStarted",(function(){h(),n=i=t.track.details.abs})),t.on("dragEnded",(function(){var r=t.options.mode;"snap"===r&&function(){var r=t.track,o=t.track.details,u=o.position,s=d(r.velocity());(u>a||u<e)&&(s=0);var c=n+s;0===o.slides[r.absToRel(c)].portion&&(c-=s),n!==i&&(c=i),d(r.idxToDist(c,!0))!==s&&(c+=s),c=l(c);var f=r.idxToDist(c,!0);t.animator.start([{distance:f,duration:500,easing:function(t){return 1+--t*t*t*t*t}}])}(),"free"!==r&&"free-snap"!==r||p()})),t.on("dragged",(function(){i=t.track.details.abs}))}function b(t){var n,i,r,a,o,u,l,f,p,v,m,h;function g(n){a&&u===n.idChanged&&(a=!1,t.emit("dragEnded"))}function b(n){var i=t.options.vertical,r=i?n.y:n.x,e=i?n.x:n.y,a=void 0!==p&&void 0!==v&&Math.abs(v-e)<=Math.abs(p-r);return p=r,v=e,a}function x(n){return t.options.vertical?n.y:n.x}function y(){var n;!function(){r=t.size;var n=t.track.details;n&&(m=n.min,h=n.max)}(),n=t.options.dragSpeed||1,o="function"==typeof n?n:function(t){return t*n},i=t.options.rtl?-1:1}t.on("updated",y),t.on("layoutChanged",y),t.on("created",y);var k=e.create({onPanResponderMove:s((function(e){if(a&&u===e.idChanged){var s=x(e);if(l){if(!b(e))return g(e);t.emit("dragChecked"),l=!1}var p=function(i){if(m===-1/0&&h===1/0)return i;var e=t.track.details,a=e.length,o=e.position,u=c(i,m-o,h-o);if(0===a)return 0;if(!t.options.rubberband)return u;if(o<=h&&o>=m)return i;if(o<m&&n>0||o>h&&n<0)return i;var s=(o<m?o-m:o-h)/a,d=r*a,l=Math.abs(s*d),f=Math.max(0,1-l/r*2);return f*f*i}(o(f-s)/t.size*i);n=d(p),t.track.add(p),f=s,t.emit("dragged")}})),onPanResponderRelease:s(g),onPanResponderTerminate:s(g),onStartShouldSetPanResponder:s((function(n){if(!a&&t.track.details&&t.track.details.length&&t.options.drag)return a=!0,l=!0,u=n.idChanged,b(n),f=x(n),t.emit("dragStarted"),!0}))});Object.assign(t.containerProps,k.panHandlers)}function x(n){return function(i){function r(t){i.animator.stop();var n=i.track.details;i.track.init(null!=t?t:n?n.abs:0)}function e(){var n=i.options.slides;if("function"==typeof n)return i.options.trackConfig=n(i.size);for(var r="number"==typeof n?n:l(n,"number",0,!0),e=[],a=l(n,"perView",1,!0),o=l(n,"spacing",0,!0)/i.size||0,u=o/a,s=l(n,"origin","auto"),c=0,d=0;d<r;d++){var f=1/a-o+u,p="center"===s?.5-f/2:"auto"===s?0:s;e.push({origin:p,size:f,spacing:o}),c+=f}if(c+=o*(r-1),"auto"===s&&!i.options.loop&&1!==a){var v=0;e.map((function(t){var n=c-v;return v+=t.size+o,n>=1||(t.origin=1-n-(c>1?0:1-c)),t}))}i.options.trackConfig=e,function(n){var r,e=i.slidesProps.length;if(e!==n){var a=n-e;a>0?(r=i.slidesProps).push.apply(r,Array(a).fill(null).map((function(){return{ref:t()}}))):i.slidesProps.splice(a)}}(i.options.trackConfig.length)}i.containerProps={onLayout:function(t){var n=i.options.vertical?t.nativeEvent.layout.height:t.nativeEvent.layout.width;n!==i.size&&(i.size=n,e(),r(),i.emit("layoutChanged"))}},i.slidesProps=[],i.update=function(t,o){t&&(i.options=a(a({},n),t)),e(),r(o),i.emit("updated")},i.options=a(a({},n),i.options),e(),function(t){function n(){t.track.details&&t.track.details.slides.forEach((function(n,i){var r=t.options.vertical?"100%":"".concat(100*n.size,"%"),e=t.options.vertical?"".concat(100*n.size,"%"):"100%",a=t.size?n.distance*t.size:100*n.distance+"%",o=t.options.vertical?0:a,u=t.options.vertical?a:0,s="absolute";t.slidesProps[i].style={height:e,left:o,position:s,top:u,width:r};var c=t.slidesProps[i].ref.current;c&&c.setNativeProps({style:{height:e,left:o,position:s,top:u,width:r}})}))}t.on("detailsChanged",n),t.on("created",n),t.on("updated",n)}(i),b(i)}}var y=function(t,n){try{return function(t,n){var i,r={};return i={emit:function(t){r[t]&&r[t].forEach((function(t){t(i)}));var n=i.options&&i.options[t];n&&n(i)},moveToIdx:function(t,n,r){var e=i.track.idxToDist(t,n);if(e){var a=i.options.defaultAnimation;i.animator.start([{distance:e,duration:l(r||a,"duration",500),easing:l(r||a,"easing",(function(t){return 1+--t*t*t*t*t}))}])}},on:function(t,n,i){void 0===i&&(i=!1),r[t]||(r[t]=[]);var e=r[t].indexOf(n);e>-1?i&&delete r[t][e]:i||r[t].push(n)},options:t},function(){if(i.track=h(i),i.animator=m(i),n)for(var t=0,r=n;t<r.length;t++)(0,r[t])(i);i.track.init(i.options.initial||0),i.emit("created")}(),i}(t,o([x({drag:!0,mode:"snap",rubberband:!0}),g],n||[],!0))}catch(t){console.error(t)}};function k(t,e){var a=n(!1),o=n(t),u=i((function(){return y(t,e)}),[]);return r((function(){a.current?u&&u.update(o.current):a.current=!0}),[v(o,t)]),u}export{y as default,k as useKeenSliderNative};
